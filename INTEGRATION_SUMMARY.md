# K-SpecPartåˆ†ææ•´åˆå®Œæˆæ€»ç»“

## âœ… å®Œæˆæ—¶é—´ï¼š2025-11-15

## ğŸ“‹ æ•´åˆå†…å®¹

### 1. æ ¸å¿ƒå‘ç°

**K-SpecPartè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ**
- âœ… è¶…å›¾åˆ†åŒºä¼˜åŒ–ï¼ˆHypergraph Partitioningï¼‰
- âœ… æœ€å°åŒ–Cutsizeï¼ˆè¢«åˆ‡æ–­çš„netsæ•°é‡ï¼‰
- âœ… æ»¡è¶³å¹³è¡¡çº¦æŸï¼ˆå„partitionå¤§å°ç›¸è¿‘ï¼‰
- âŒ **ä¸ç”Ÿæˆåˆ†åŒºç½‘è¡¨**
- âŒ **ä¸åšFormaléªŒè¯**
- âŒ **ä¸åšç‰©ç†å¸ƒå±€**

**å…³é”®ç»“è®º**ï¼š
```
K-SpecPart = "å†³ç­–è€…"ï¼ˆLogic-levelï¼‰
VerilogPartitioner = "æ‰§è¡Œè€…"ï¼ˆImplementation-levelï¼‰â† æˆ‘ä»¬éœ€è¦å®ç°
FormaléªŒè¯ = "è´¨é‡ä¿è¯"ï¼ˆCorrectnessï¼‰â† å·²æœ‰æ¨¡å—
```

### 2. æ–‡æ¡£æ›´æ–°

#### 2.1 README.mdæ›´æ–°
- âœ… æ–°å¢"K-SpecParté›†æˆä¸åˆ†åŒºæµç¨‹"ç« èŠ‚
- âœ… æ·»åŠ å®Œæ•´çš„8æ­¥Partition-based Flowæµç¨‹å›¾
- âœ… æ˜ç¡®è¯´æ˜K-SpecPartçš„ä½œç”¨å’Œå±€é™
- âœ… åˆ—å‡ºå¾…å®ç°çš„æ ¸å¿ƒæ¨¡å—ï¼ˆVerilogPartitionerç­‰ï¼‰
- âœ… æ·»åŠ Yosysåˆ°"å·²å®‰è£…ç»„ä»¶"è¡¨æ ¼
- âœ… æ›´æ–°æœåŠ¡å™¨ç¯å¢ƒä¿¡æ¯

#### 2.2 WORK_SUMMARY_AND_PLAN.mdæ›´æ–°
- âœ… æ·»åŠ "K-SpecPartæ ¸å¿ƒå‘ç°"ç« èŠ‚
- âœ… æ˜ç¡®VerilogPartitionerçš„å¿…è¦æ€§å’ŒåŠŸèƒ½æ¥å£
- âœ… è¯´æ˜8æ­¥å®Œæ•´æµç¨‹
- âœ… æ›´æ­£"é—®é¢˜1"ï¼šç¡®è®¤ISPD 2015æœ‰é—¨çº§ç½‘è¡¨
- âœ… å¼ºè°ƒFormaléªŒè¯çš„å¿…è¦æ€§

#### 2.3 chipmasrag.plan.md
- âœ… å·²æœ‰å®Œæ•´çš„FormaléªŒè¯ä»£ç æ¡†æ¶ï¼ˆ1378-1464è¡Œï¼‰
- âœ… å·²æœ‰å±‚çº§åŒ–æ”¹é€ çš„è¯¦ç»†å®ç°ï¼ˆ1192-1406è¡Œï¼‰
- âœ… å·²æœ‰K-SpecPartä¸OpenROADè¡”æ¥æ–¹æ¡ˆï¼ˆ1099-1579è¡Œï¼‰
- âš ï¸ æ— éœ€é¢å¤–ä¿®æ”¹ï¼ˆæ–‡æ¡£å·²å®Œæ•´ï¼‰

### 3. åˆ é™¤ä¸´æ—¶æ–‡ä»¶

- âœ… åˆ é™¤ `KSPECPART_ANALYSIS.md`ï¼ˆå·²æ•´åˆåˆ°READMEå’Œplanï¼‰

### 4. æ ¸å¿ƒæ¨¡å—å¾…å®ç°æ¸…å•

| æ¨¡å— | æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ | æ—¶é—´ |
|------|------|------|--------|------|
| **VerilogPartitioner** | `src/utils/verilog_partitioner.py` | åŸºäºK-SpecPartç»“æœç”Ÿæˆåˆ†åŒºç½‘è¡¨ | P0 ğŸ”¥ | 1å¤© |
| **FormaléªŒè¯é›†æˆ** | å·²æœ‰`formal_verification.py` | éªŒè¯flatten â‰ˆ hierarchical | P0 ğŸ”¥ | 0.5å¤© |
| **Partition-based Flow** | `scripts/run_partition_based_flow.py` | å®Œæ•´æµç¨‹ç¼–æ’ | P0 ğŸ”¥ | 0.5å¤© |

**æ€»è®¡**ï¼š2å¤©ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

## ğŸ¯ å…³é”®æŠ€æœ¯ç‚¹

### VerilogPartitionerå·¥ä½œæµç¨‹

```python
# è¾“å…¥
design_v = "data/ispd2015/mgc_fft_1/design.v"  # 32281ä¸ªç»„ä»¶çš„é—¨çº§ç½‘è¡¨
part_file = "results/kspecpart/mgc_fft_1/mgc_fft_1.part.4"  # K-SpecPartè¾“å‡º
mapping_file = "results/kspecpart/mgc_fft_1/mgc_fft_1.mapping.json"

# VerilogPartitionerå¤„ç†
partitioner = VerilogPartitioner(design_v, part_file, mapping_file)
result = partitioner.partition()

# è¾“å‡º
partition_files = {
    0: "partition_0.v",  # 7297ä¸ªç»„ä»¶
    1: "partition_1.v",  # 7329ä¸ªç»„ä»¶
    2: "partition_2.v",  # 8822ä¸ªç»„ä»¶
    3: "partition_3.v"   # 8833ä¸ªç»„ä»¶
}
top_file = "top.v"  # å®ä¾‹åŒ–4ä¸ªpartitionæ¨¡å—
boundary_nets = {
    "n_13984": [0, 1],  # è¿æ¥partition 0å’Œ1
    ...  # å…±219æ¡boundary nets
}
```

### FormaléªŒè¯æµç¨‹

```bash
# YosyséªŒè¯è„šæœ¬ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
read_verilog design.v          # åŸå§‹flatten
hierarchy -check -top design
flatten
rename -top gold

read_verilog top.v             # å±‚çº§åŒ–
read_verilog partition_0.v
read_verilog partition_1.v
read_verilog partition_2.v
read_verilog partition_3.v
hierarchy -check -top design
flatten
rename -top gate

equiv_make gold gate equiv     # ç­‰ä»·æ€§æ£€æŸ¥
equiv_simple -seq 5
equiv_induct -seq 5
equiv_status -assert           # æ–­è¨€éªŒè¯
```

## ğŸ“Š å®Œæ•´æµç¨‹ï¼ˆ8æ­¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥ï¼šdesign.v (flattené—¨çº§ç½‘è¡¨, 32281 components)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: K-SpecPart è¶…å›¾åˆ†åŒºï¼ˆå·²å®Œæˆâœ…ï¼‰                      â”‚
â”‚   â†’ .part.4ï¼ˆ32281è¡Œï¼Œæ¯è¡Œä¸€ä¸ªpartition_id: 0-3ï¼‰           â”‚
â”‚   â†’ Cutsize=219ï¼ˆè¢«åˆ‡æ–­çš„netsæ•°é‡ï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: VerilogPartitionerï¼ˆå¾…å®ç° ğŸ”¥ï¼‰                     â”‚
â”‚   â†’ partition_0.v ~ partition_3.v (å„åˆ†åŒºå­ç½‘è¡¨)           â”‚
â”‚   â†’ top.v (é¡¶å±‚ç½‘è¡¨ï¼Œå®ä¾‹åŒ–4ä¸ªpartitionæ¨¡å—)                â”‚
â”‚   â†’ boundary_nets.json (è¾¹ç•Œnetsåˆ†æï¼Œ219æ¡)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: FormaléªŒè¯ï¼ˆYosysï¼‰â­ å…³é”®                          â”‚
â”‚   éªŒè¯ï¼šdesign.v â‰ˆ top.v + partition_*.v                    â”‚
â”‚   â†’ ç¡®ä¿å±‚æ¬¡åŒ–æ”¹é€ ååŠŸèƒ½ç­‰ä»·                                 â”‚
â”‚   ï¼ˆå·²æœ‰æ¨¡å—ï¼šformal_verification.pyï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ç‰©ç†ä½ç½®ä¼˜åŒ–ï¼ˆå·²å®ç°âœ…ï¼‰                             â”‚
â”‚   â†’ åŸºäºboundary_netsçš„è¿æ¥æ€§ä¼˜åŒ–partitionå¸ƒå±€              â”‚
â”‚   â†’ physical_regions = {0: (x,y,w,h), ...}                 â”‚
â”‚   ï¼ˆå·²æœ‰æ¨¡å—ï¼šphysical_mapping.pyï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: å„Partition OpenROADæ‰§è¡Œï¼ˆå¹¶è¡Œï¼‰ï¼ˆå¾…å®ç°ï¼‰          â”‚
â”‚   â†’ partition_0_layout.def ~ partition_3_layout.def        â”‚
â”‚   â†’ æå–å„partitionçš„internal HPWL                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Macro LEFç”Ÿæˆï¼ˆå·²å®ç°âœ…ï¼‰                            â”‚
â”‚   â†’ partition_0.lef ~ partition_3.lef                       â”‚
â”‚   â†’ å°†partitionè§†ä¸ºmacroï¼Œç”¨äºé¡¶å±‚ç»„è£…                      â”‚
â”‚   ï¼ˆå·²æœ‰æ¨¡å—ï¼šmacro_lef_generator.pyï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: é¡¶å±‚OpenROADæ‰§è¡Œï¼ˆboundary nets onlyï¼‰ï¼ˆå¾…å®ç°ï¼‰     â”‚
â”‚   â†’ top_layout.def (åªå¸ƒçº¿boundary nets)                    â”‚
â”‚   â†’ æå–boundary HPWL                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: è¾¹ç•Œä»£ä»·è®¡ç®—ï¼ˆå¾…å®ç°ï¼‰                               â”‚
â”‚   BC = HPWL_boundary / HPWL_internal_total Ã— 100%          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å·²å®Œæˆ**ï¼šStep 1, 4, 6ï¼ˆ3/8ï¼‰
**å¾…å®ç°**ï¼šStep 2, 5, 7, 8ï¼ˆ5/8ï¼‰
**å·²æœ‰æ¨¡å—å¯ç”¨**ï¼šStep 3ï¼ˆFormaléªŒè¯ï¼‰

## ğŸ”— å‚è€ƒæ–‡æ¡£

- **README.md**ï¼š"K-SpecParté›†æˆä¸åˆ†åŒºæµç¨‹"ç« èŠ‚
- **WORK_SUMMARY_AND_PLAN.md**ï¼šé˜¶æ®µ3è¯¦ç»†è®¡åˆ’
- **docs/chipmasrag.plan.md**ï¼šå®Œæ•´æŠ€æœ¯æ–¹æ¡ˆï¼ˆ1192-1579è¡Œï¼‰
- **docs/physical_mapping_explanation.md**ï¼šç‰©ç†ä½ç½®ä¼˜åŒ–è¯¦è§£

## â­ï¸ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å®ç°VerilogPartitioner**ï¼ˆP0 ğŸ”¥ï¼‰ï¼š
1. åˆ›å»º `src/utils/verilog_partitioner.py`
2. å®ç°Verilogè§£æï¼ˆé—¨çº§ç½‘è¡¨ï¼‰
3. å®ç°boundary netsè¯†åˆ«
4. ç”Ÿæˆpartitionå­ç½‘è¡¨
5. ç”Ÿæˆtopç½‘è¡¨
6. é›†æˆFormaléªŒè¯
7. å•å…ƒæµ‹è¯•

**é¢„è®¡æ—¶é—´**ï¼š1å¤©
